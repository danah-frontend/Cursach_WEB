<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –ú–∞–≥–∞–∑–∏–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <style>
        .profile-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 0;
        }
        .profile-card {
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2.5rem;
        }
        .profile-info {
            padding: 2rem;
            background: white;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        .info-item {
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 0.375rem;
            border-left: 4px solid #667eea;
        }
        .info-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 0.5rem;
        }
        .info-value {
            color: #212529;
            font-size: 1.1rem;
        }
        .role-badge {
            background: #667eea;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            display: inline-block;
            margin: 0.25rem;
        }
        .admin-badge { background-color: #dc3545; }
        .moderator-badge { background-color: #ffc107; color: #000; }
        .user-badge { background-color: #28a745; }
    </style>
</head>
<body>
<nav class="container-fluid">
    <ul>
        <li><strong>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ãPRO</strong></li>
    </ul>
    <ul>
        <li><a th:href="@{/}">–ì–ª–∞–≤–Ω–∞—è</a></li>
        <li><a th:href="@{/products/all}">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</a></li>

        <!-- –ú–ï–ù–Æ –î–õ–Ø –ê–î–ú–ò–ù–û–í –ò –ú–û–î–ï–†–ê–¢–û–†–û–í -->
        <li sec:authorize="hasAnyRole('ADMIN', 'MODERATOR')">
            <a th:href="@{/products/add}">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a>
        </li>
        <li sec:authorize="hasAnyRole('ADMIN', 'MODERATOR')">
            <a th:href="@{/orders/admin}">–í—Å–µ –∑–∞–∫–∞–∑—ã</a>
        </li>

        <!-- –ú–ï–ù–Æ –¢–û–õ–¨–ö–û –î–õ–Ø –û–ë–´–ß–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô -->
        <li sec:authorize="hasRole('USER') and !hasAnyRole('ADMIN', 'MODERATOR')">
            <a th:href="@{/cart}">–ö–æ—Ä–∑–∏–Ω–∞ (<span th:text="${cartItemCount}">0</span>)</a>
        </li>
        <li sec:authorize="hasRole('USER') and !hasAnyRole('ADMIN', 'MODERATOR')">
            <a th:href="@{/orders}">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</a>
        </li>

        <!-- –ö–ù–û–ü–ö–ò –í–•–û–î–ê/–†–ï–ì–ò–°–¢–†–ê–¶–ò–ò (–¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) -->
        <li sec:authorize="!isAuthenticated()">
            <a th:href="@{/users/login}" role="button" class="outline">–í—Ö–æ–¥</a>
        </li>
        <li sec:authorize="!isAuthenticated()">
            <a th:href="@{/users/register}" role="button" class="secondary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        </li>

        <!-- –ü–†–û–§–ò–õ–¨ –ò –í–´–•–û–î -->
        <li sec:authorize="isAuthenticated()">
            <a th:href="@{/users/profile}" role="button" class="outline">–ü—Ä–æ—Ñ–∏–ª—å</a>
        </li>
        <li sec:authorize="isAuthenticated()">
            <form th:action="@{/users/logout}" method="post" style="display: inline;">
                <button type="submit" class="contrast small">–í—ã–π—Ç–∏</button>
            </form>
        </li>
    </ul>
</nav>

<main class="container">
    <div class="profile-container">
        <article class="profile-card" th:object="${user}">
            <div class="profile-header">
                <div class="profile-avatar">
                    üë§
                </div>
                <h1 th:text="*{name} ?: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
                <div>
                    <span th:each="roleItem : ${#strings.arraySplit(user.role, ',')}"
                          th:text="${roleItem}"
                          th:class="${#strings.contains(roleItem, 'Admin')} ? 'role-badge admin-badge' :
                                    (${#strings.contains(roleItem, 'Moderator')} ? 'role-badge moderator-badge' : 'role-badge user-badge')">
                    </span>
                </div>
            </div>

            <div class="profile-info">
                <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ñ–∏–ª–µ</h2>

                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Email</div>
                        <div class="info-value" th:text="*{email}">email@example.com</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">–ò–º—è</div>
                        <div class="info-value" th:text="*{name} ?: '–ù–µ —É–∫–∞–∑–∞–Ω–æ'">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">–¢–µ–ª–µ—Ñ–æ–Ω</div>
                        <div class="info-value" th:text="*{phone} ?: '–ù–µ —É–∫–∞–∑–∞–Ω'">+7 (XXX) XXX-XX-XX</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">–†–æ–ª–∏</div>
                        <div class="info-value">
                            <div th:each="roleItem : ${#strings.arraySplit(user.role, ',')}">
                                <span th:text="${roleItem}"
                                      th:class="${#strings.contains(roleItem, 'Admin')} ? 'role-badge admin-badge' :
                                                (${#strings.contains(roleItem, 'Moderator')} ? 'role-badge moderator-badge' : 'role-badge user-badge')">
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                    <div class="grid" style="margin-top: 1rem; gap: 1rem;">
                        <!-- –¢–û–õ–¨–ö–û –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                        <a sec:authorize="hasRole('USER') and !hasAnyRole('ADMIN', 'MODERATOR')"
                           th:href="@{/cart}" role="button" class="outline">–ú–æ—è –∫–æ—Ä–∑–∏–Ω–∞</a>
                        <a sec:authorize="hasRole('USER') and !hasAnyRole('ADMIN', 'MODERATOR')"
                           th:href="@{/orders}" role="button" class="outline">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</a>

                        <!-- –¢–û–õ–¨–ö–û –¥–ª—è ADMIN (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤) -->
                        <a sec:authorize="hasRole('ADMIN')"
                           th:href="@{/products/add}"
                           role="button" class="outline">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a>

                        <!-- –î–ª—è ADMIN –∏ MODERATOR (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏) -->
                        <a sec:authorize="hasAnyRole('ADMIN', 'MODERATOR')"
                           th:href="@{/orders/admin}"
                           role="button" class="outline">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</a>

                        <!-- –î–ª—è –≤—Å–µ—Ö –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö -->
                        <a th:href="@{/products/all}" role="button" class="outline">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</a>
                    </div>
                </div>

                <div style="margin-top: 2rem; text-align: center;">
                    <div class="grid" style="justify-content: center; gap: 1rem;">
                        <a th:href="@{/}" role="button" class="secondary">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                        <form th:action="@{/users/logout}" method="post" style="display: inline;">
                            <button type="submit" class="contrast">–í—ã–π—Ç–∏</button>
                        </form>
                    </div>
                </div>
            </div>
        </article>
    </div>
</main>

<footer class="container">
    <small>¬© 2024 –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ãPRO</small>
</footer>
</body>
</html>